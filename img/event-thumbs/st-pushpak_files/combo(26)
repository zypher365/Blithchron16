YUI.add("hermes-template-bulk-download-modal",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+="\n	<p>",s={hash:{intlName:"album-page.DOWNLOAD_ALBUM_LICENSE_MESSAGE_ALT_2"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</p>\n",r}function h(e,t){var r="",i,s;return r+="\n	<p>",s={hash:{intlName:"album-page.ALOT_OF_PHOTOS"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,s):u.call(e,"intlMessage",s)))+"</p>\n",r}function p(e,t){var r="",i;r+="\n	<ul>\n		",i=n.each.call(e,e.downloadURLs,{hash:{},inverse:l.noop,fn:l.program(6,d,t),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n",r}function d(e,t){var r="",i,s,o;return r+="\n			<li>\n				<span>\n					",o={hash:{intlName:"album-page.DOWNLOAD_ZIP_PART",partSequence:e.partSequence},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+'\n				</span>\n				<a class="butt mini" href="',(s=n.url)?s=s.call(e,{hash:{},data:t}):(s=e.url,s=typeof s===f?s.apply(e):s),r+=a(s)+'">',o={hash:{intlName:"common.DOWNLOAD"},data:t},r+=a((i=n.intlMessage||e.intlMessage,i?i.call(e,o):u.call(e,"intlMessage",o)))+"</a>\n			</li>\n		",r}function v(e,t){var r="",i,s;return r+='\n	<a class="butt mini" href="'+a((i=(i=(i=e.downloadURLs,i==null||i===!1?i:i[0]),i==null||i===!1?i:i.url),typeof i===f?i.apply(e):i))+'">',(s=n.buttonLabel)?s=s.call(e,{hash:{},data:t}):(s=e.buttonLabel,s=typeof s===f?s.apply(e):s),r+=a(s)+"</a>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;o=n.unless.call(t,t.isOwnAlbum,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;s+="\n\n",o=n["if"].call(t,t.isMany,{hash:{},inverse:l.noop,fn:l.program(3,h,i),data:i});if(o||o===0)s+=o;s+="\n\n",o=n["if"].call(t,t.isMany,{hash:{},inverse:l.program(8,v,i),fn:l.program(5,p,i),data:i});if(o||o===0)s+=o;return s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/bulk-download-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("bulk-downloader-view",function(e,t){"use strict";e.BulkDownloaderView=e.Base.create("BulkDownloaderView",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.localizeLib=e.mix({langBundles:["common","album-page","cameraroll"],appContext:this.appContext},e.Localizable),this.set("isOwnAlbum",t.isOwnAlbum)},showLoadingDialog:function(){var t=(new e.Views.FluidModal({appContext:this.appContext,showCancelButton:!1,showFooter:!1,showActionButton:!1,title:this.localizeLib.intlMessage({intlName:"cameraroll.PREPARING_DOWNLOAD"}),message:this.templates("flickr-balls")({}),classList:"bulk-download-loading-dialog"})).show();return t},prepareArchive:function(e){var t=this;return this.appContext.callAPI("flickr.download.archives.create",e).then(function(e){var n=e.archive.countPhotos,r=e.archive.countVideos,i=[],s,o;if(n>0&&r>0)s=t.localizeLib.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS_AND_VIDEO",photoCount:n,videoCount:r});else if(n>0&&r===0)s=t.localizeLib.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:n});else{if(!(n===0&&r>0))throw new Error(t.localizeLib.intlMessage({intlName:"cameraroll.DOWNLOAD_NOT_AVAILABLE_ERROR"}));s=t.localizeLib.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:r})}return r+n>1?o=t.localizeLib.intlMessage({intlName:"album-page.DOWNLOAD_ZIP"}):n===1&&r===0?o=t.localizeLib.intlMessage({intlName:"album-page.DOWNLOAD_PHOTOS",photoCount:n}):n===0&&r===1&&(o=t.localizeLib.intlMessage({intlName:"album-page.DOWNLOAD_VIDEOS",videoCount:r})),i=e.archive.urls.map(function(e,t){return{url:e,partSequence:t+1}}),{title:s,downloadURLs:i,buttonLabel:o}}).catch(function(e){throw e.code===105?new Error(t.localizeLib.intlMessage({intlName:"cameraroll.DOWNLOAD_DISABLED_ERROR"})):new Error(t.localizeLib.intlMessage({intlName:"cameraroll.DOWNLOAD_GENERIC_ERROR"}))})},showDownloadDialog:function(n){var r=n.title,i=n.downloadURLs,s;return s=(new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,dismissOnActionClick:!0,showCancelButton:!1,showFooter:!1,showActionButton:!1,title:r,message:this.templates("bulk-download-modal")({isMany:i.length>1,downloadURLs:i,buttonLabel:n.buttonLabel,isOwnAlbum:this.get("isOwnAlbum")}),classList:"bulk-download-dialog"})).show(),s.on("activated",function(){s.get("container").all(".butt").on("click",function(n){i.length===1?(e.rapidTracker.beacon(t,"completeArchiveDownloadClick"),s.close()):(e.rapidTracker.beacon(t,"partialArchiveDownloadClick"),n.target.addClass("is-disabled"))})}),s},onError:function(t){var n=new e.Views.FluidModal({appContext:this.appContext,title:this.localizeLib.intlMessage({intlName:"common.ERROR"}),message:t.message,actionButtonLabel:this.localizeLib.intlMessage({intlName:"common.OK"}),showCancelButton:!1});n.show()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-bulk-download-modal","hermes-template-flickr-balls","fluid-balls-css","bulk-download-modal-css"],langBundles:["common","album-page","cameraroll"],optional:[],affinity:"client"});
